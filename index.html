<!doctype html>
     <html lang="en">
     <head>
          <title>PROVA</title>
          <meta charset="utf-8" />
          <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

           <!-- Bootstrap CSS -->
          <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
          <!-- Leaflet CSS -->
          <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
          <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
          <!-- jQuery first, then Popper.js, then Bootstrap JS -->
          <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
          <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
          <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
          <!-- Leaflet JS -->
          <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
          <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
          <!-- DADES -->
          <script src="geojson.js" type="text/javascript"></script>

          <style> 
               body {
                    padding: 0;
                    margin: 0;
               }
               html, body, #mapid {
                    height: 100%;
               }
               #botonera {}
          </style> 
     </head>

     <body>
          <div align="center" class="container">
               <div class="jumbotron">
                    <h1>Operadors del Transport Integrat</h1>      
                    <p>Aquest Geoportal mostra totes les oficines de venda dels diferents operadors que formen la xarxa integrada de Transport</p>
               </div>
     
          </div>
          <!-- CREEM EL PANELL DE SELECCIÓ -->
          <div align="center" style="text-align:center">
               <label>Visualitza per Població</label>
               <select id="Població" onchange="estilPoblacio()">
                    <option value="NETEJA"></option>
                    <option value="MOSTRA'LS TOTS">MOSTRA'LS TOTS</option>
                    <script>
                         var arr = new Array
                         for(var i = 0; i < data.features.length; i++){
                              arr.push(data.features[i].properties.Població_)
                         var unique = [...new Set(arr)];
                         }
                         for(var i = 0; i < unique.length; i++){
                              var tag = document.createElement("option");
                              var text = document.createTextNode(unique[i]);
                              tag.appendChild(text);
                              tag.value = unique[i];
                              var element = document.getElementById("Població");
                              element.appendChild(tag);
                         }
                    </script>
               </select>
               
               <label>Visualitza per Operador</label>
               <select id="Operador" onchange="colorPerOperador()">
                    <option value="NETEJA"></option>
                    <option value="MOSTRA'LS TOTS">MOSTRA'LS TOTS</option>
                    <script>
                         var arr = new Array
                         for(var i = 0; i < data.features.length; i++){
                              arr.push(data.features[i].properties.Nom_operad)
                         var unique = [...new Set(arr)];
                         }
                         for(var i = 0; i < unique.length; i++){
                              var tag = document.createElement("option");
                              var text = document.createTextNode(unique[i]);
                              tag.appendChild(text);
                              tag.value = unique[i];
                              var element = document.getElementById("Operador");
                              element.appendChild(tag);
                         }
                    </script>
                     
               </select>
               <label>Visualitza per Zona OAC</label>
               <select id="Zona_OAC" >
                    <option value="NETEJA"></option>
                    <option value="MOSTRA'LS TOTS">MOSTRA'LS TOTS</option>
                    <script>
                         var arr = new Array
                         for(var i = 0; i < data.features.length; i++){
                              arr.push(data.features[i].properties.Zona_OAC)
                         var unique = [...new Set(arr)];
                         }
                         for(var i = 0; i < unique.length; i++){
                              var tag = document.createElement("option");
                              var text = document.createTextNode(unique[i]);
                              tag.appendChild(text);
                              tag.value = unique[i];
                              var element = document.getElementById("Zona_OAC");
                              element.appendChild(tag);
                         }
                    </script>
               </select>
          </div>	  

          <div id="mapid"></div>
          <script>

               var mymap = L.map('mapid').setView([41.392264, 2.162247], 13);

               var geojsonMarkerOptions = {
                    radius: 8,
                    fillColor: "#ff7800",
                    color: "#000",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8     
                    };
               
               var oficines =  L.geoJson(data, {
               onEachFeature: popUpInfo,
               pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, geojsonMarkerOptions);
               }})

               var osm = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                    maxZoom: 18,
                    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                         '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                         'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                    id: 'mapbox/streets-v11',
                    tileSize: 512,
                    zoomOffset: -1
               }).addTo(mymap);

               var mapboxbasic = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
                    maxZoom: 18,
                    zIndex: 1
               });

               var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    maxZoom: 18,
                    zIndex: 3
               });

               var basemap = {
                    'OSM': osm,
                    'Streets': mapboxbasic,
                    'ESRI Imagery': Esri_WorldImagery
               };

               var overlayMaps = {
                    'OFICINES':oficines
               };

               L.control.layers(basemap, overlayMaps).addTo(mymap);
               L.control.scale().addTo(mymap);
               L.Control.geocoder().addTo(mymap);
               var grup = L.layerGroup().addTo(mymap);

              

               function popUpInfo(feature, layer) {
                    
                    const popupContent = 
                              `<table>
                              <tr>
                              <th>Operador:</th>
                              <td>${feature.properties.Nom_operad}</td>
                              </tr>
                              <tr>
                              <th>Zona OAC:</th>
                              <td>${feature.properties.Zona_OAC}</td>
                              </tr>
                              <tr>
                              <th>Direcció:</th>
                              <td>${feature.properties.Direcció}</td>
                              </tr>
                              </table>`;

                         if (feature.properties) {
                              layer.bindPopup(popupContent);
                         }
               }

               function colorPerOperadors(d) { 
					return d == "Transports Mir" ? 'lavender' : 
					d == "TUS" ? 'maroon' : 
					d == "TEISA-Hispano Hilarienca" ? 'springgreen' : 
					d == "Autocars Vendrell" ? 'palegreen' :
                         d == "Monbús" ? 'navajowhite' :
                         d == "Tusgsal" ? 'sandybrown' :
                         d == "Transports Pujol i Pujol" ? 'silver' :
                         d == "Transports Mir" ? 'antiquewhite' :
                         d == "TRAM" ? 'deeppink' :
                         d == "Tmesa" ? 'fuchsia' :
                         d == "TMB" ? 'lime' :
                         d == "TCC-Authosa" ? 'olive' :
                         d == "Soler i sauret, Molins Bus, SantVi bus, ValldoreixBus" ? 'chocolate' :
                         d == "Sarbus" ? 'brown' :
                         d == "Renfe" ? 'goldenrod' :
                         d == "Martí Colomer" ? 'chocolate' :
                         d == "Jordi Comasòlivas" ? 'bisque' :
                         d == "Hispano Llacunense" ? 'darkslategray' :
                         d == "Hispano Igualadina Monbus-Paral lel el Port UTE" ? 'pink' :
                         d == "'Grup TGO-Masats Transports Generals-Autos Castellbisbal" ? 'darkviolet' :
                         d == "Grup Sagales" ? 'indigo' :
                         d == "Germans Montferri" ? 'violet' :
                         d == "FGC" ? '	navy' :
                         d == "CTSA - Mataró Bus i Rubi bus" ? 'steelblue' :
                         d == "CENTRE T-MOBILITAT" ? '	lightseagreen' :
                         d == "Bus Castellví" ? 'aqua' :
                         d == "Baixbus" ? 'aquamarine' :
                         d == "Autocorb" ? 'red' :
                         d == "Autocars Rovira" ? 'orange' :
                         d == "Autocars R.Font" ? 'yellow' :
                         d == "Autocars Prat" ? 'green' :
                         d == "Autocars Julià" ? 'blue' :
                         d == "AMB" ? 'gray' :
                         d == "Alsina Graells/ALSA" ? 'grey' :
								'black'; 
               };

               function estilOperador (feature) {
                    return{
                         radius: 7,
                         fillColor: colorPerOperadors(feature.properties.Nom_operad), 
                         color: colorPerOperadors(feature.properties.Nom_operad), 
                         weight: 1,
                         opacity : 1,
                         fillOpacity : 0.8
                    };
               };

               function colorPerOperador() {
                    var select = document.getElementById("Operador").value; 
                    var capa = L.geoJSON(data, {
                                        pointToLayer: function (feature, latlng) {
                                                  return L.circleMarker(latlng, geojsonMarkerOptions);
                                             },
                                        filter: function(feature, layer) {
                                                  if(select != "MOSTRA'LS TOTS" && select != ''){
                                                       return (feature.properties.Nom_operad == select);
                                                  }
                                                  else if(select == ""){
                                                       grup.clearLayers();
                                                  }
                                                  else{
                                                       return true;
                                                  }		
                                        },	
                                        style:estilOperador,
                                        onEachFeature: popUpInfo	
                                        })
                    grup.clearLayers();
                    grup.addLayer(capa);
               };
          </script>
     </body>

</html>
